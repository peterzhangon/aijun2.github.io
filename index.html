<!DOCTYPE html>

<html>
<link href='https://fonts.googleapis.com/css?family=Lato:300,900' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="css/basic.css" />

<!-- import d3.v4 -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

  <head>
    <title>A whole picture on Covid-19 Cases and Deaths in USA</title>
  </head>

  <body>

  <!-- page 0: home page overview -->
  <!-- ************************** -->
  <section class="" id="section_home_page">
    <button type="button", id="home_home_button" >Home</button>
    <button type="button", id="home_pre_button" >Previous</button>
    <button type="button" onclick="update_home_next()">Next</button>
    <H1>Page-1: Overview of Covid-19 Status in USA</H1>
    <h2><br/>Contents</h2>

    <ul>
        <li>Page-1: Overview of Covid-19 Status in USA</li>
        <li>Page-2: Covid-19 Trends</li>
        <li>Page-3: Cases Comparison Between States</li>
        <li>Page-4: Choropleth Map with Tooltips</li>
        <li>Page-5: Thank You</li>
    </ul>

    <h2><br/>How to switch between pages</h2>

    <ul>
        <li>The user may click the <mark>Next</mark> button to go to the next page.</li>
        <li>The user can click the <mark>Previous</mark> button to go to the previous page</li>
        <li>The Previous or Next button is <mark>disabled</mark>, when it is not valid.</li>
    </ul>

    <h2><br/>Related Resources</h2>
    <ul>
        <li><a href='https://github.com/nytimes/covid-19-data/blob/master/us-states.csv' target='_blank'>Data source</a></li>
        <li><a href='https://github.com/nytimes/covid-19-data/blob/master/us-states.csv' target='_blank'>Source code of this project</a></li>
        <li><a href='https://public.tableau.com/app/profile/aijun2/viz/project_dashboard_16237246680960/Dashboard' target='_blank'>Overview of US States Covid-19 Cases and Deaths based on data from Jan. 2020 to June 2021 via Tableau</a></li>
    </ul>

  </section>

  <!-- page 1: multiple lines -->
  <!-- ************************** -->
  <section class="" id="section_mul_lines">
    <button type="button" onclick="init_pages()">Home</button>
    <button type="button" onclick="update_mul_lines_pre()">Previous</button>
    <button type="button" onclick="update_mul_lines_next()">Next</button>

    <H1>Page-2: Covid-19 Trends</H1>

    <!-- Create a div where the graph will take place -->
    <div id="tooltip_lines_left"></div>
    <div id="mul_line_left"></div>

    <div>
      <svg id="legend_mul_lines" height=300 width=950></svg>
    </div>
    <script>

    // http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e
    format_num = d3.format(",d")
    var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    var all_colors_based_on_idx = {
      0: "#1b70fc",
      1: "#faff16",
      2: "#d50527",
      3: "#158940",
      4: "#f898fd",
      5: "#24c9d7",
      6: "#cb9b64",
      7: "#866888",
      8: "#22e67a",
      9: "#e509ae",
      10: "#9dabfa",
      11: "#437e8a",
      12: "#b21bff",
      13: "#ff7b91",
      14: "#94aa05",
      15: "#ac5906",
      16: "#82a68d",
      17: "#fe6616",
      18: "#7a7352",
      19: "#f9bc0f",
      20: "#b65d66",
      21: "#07a2e6",
      22: "#c091ae",
      23: "#8a91a7",
      24: "#88fc07",
      25: "#ea42fe",
      26: "#9e8010",
      27: "#10b437",
      28: "#c281fe",
      29: "#f92b75",
      30: "#07c99d",
      31: "#a946aa",
      32: "#bfd544",
      33: "#16977e",
      34: "#ff6ac8",
      35: "#a88178",
      36: "#5776a9",
      37: "#678007",
      38: "#fa9316",
      39: "#85c070",
      40: "#6aa2a9",
      41: "#989e5d",
      42: "#fe9169",
      43: "#cd714a",
      44: "#6ed014",
      45: "#c5639c",
      46: "#c23271",
      47: "#698ffc",
      48: "#678275",
      49: "#c5a121",
      50: "#a978ba",
      51: "#ee534e",
      52: "#d24506",
      53: "#59c3fa",
      54: "#ca7b0a",
      55: "#6f7385"
      };

      var all_colors_based_on_state = {
        "Alabama":                        "#1b70fc",
        "Alaska":                         "#faff16",
        "Arizona":                        "#d50527",
        "Arkansas":                       "#158940",
        "California":                     "#f898fd",
        "Colorado":                       "#24c9d7",
        "Connecticut":                    "#cb9b64",
        "Delaware":                       "#866888",
        "District of Columbia":           "#22e67a",
        "Florida":                        "#e509ae",
        "Georgia":                        "#9dabfa",
        "Guam":                           "#437e8a",
        "Hawaii":                         "#b21bff",
        "Idaho":                          "#ff7b91",
        "Illinois":                       "#94aa05",
        "Indiana":                        "#ac5906",
        "Iowa":                           "#82a68d",
        "Kansas":                         "#fe6616",
        "Kentucky":                       "#7a7352",
        "Louisiana":                      "#f9bc0f",
        "Maine":                          "#b65d66",
        "Maryland":                       "#07a2e6",
        "Massachusetts":                  "#c091ae",
        "Michigan":                       "#8a91a7",
        "Minnesota":                      "#88fc07",
        "Mississippi":                    "#ea42fe",
        "Missouri":                       "#9e8010",
        "Montana":                        "#10b437",
        "Nebraska":                       "#c281fe",
        "Nevada":                         "#f92b75",
        "New Hampshire":                  "#07c99d",
        "New Jersey":                     "#a946aa",
        "New Mexico":                     "#bfd544",
        "New York":                       "#16977e",
        "North Carolina":                 "#ff6ac8",
        "North Dakota":                   "#a88178",
        "Northern Mariana Islands":       "#5776a9",
        "Ohio":                           "#678007",
        "Oklahoma":                       "#fa9316",
        "Oregon":                         "#85c070",
        "Pennsylvania":                   "#6aa2a9",
        "Puerto Rico":                    "#989e5d",
        "Rhode Island":                   "#fe9169",
        "South Carolina":                 "#cd714a",
        "South Dakota":                   "#6ed014",
        "Tennessee":                      "#c5639c",
        "Texas":                          "#c23271",
        "Utah":                           "#698ffc",
        "Vermont":                        "#678275",
        "Virgin Islands":                 "#c5a121",
        "Virginia":                       "#a978ba",
        "Washington":                     "#ee534e",
        "West Virginia":                  "#d24506",
        "Wisconsin":                      "#59c3fa",
        "Wyoming":                        "#ca7b0a"
        };
        var all_states = [
          "Alabama",
          "Alaska",
          "Arizona",
          "Arkansas",
          "California",
          "Colorado",
          "Connecticut",
          "Delaware"];
        var all_states_g1 = [
          "Alabama",
          "Alaska",
          "Arizona",
          "Arkansas",
          "California",
          "Colorado",
          "Connecticut",
          "Delaware"];
      var all_states_g2 = [
          "District of Columbia",
          "Florida",
          "Georgia",
          "Guam",
          "Hawaii",
          "Idaho",
          "Illinois",
          "Indiana"];
      var all_states_g3 = [
          "Iowa",
          "Kansas",
          "Kentucky",
          "Louisiana",
          "Maine",
          "Maryland",
          "Massachusetts",
          "Michigan"];

      var all_states_g4 = [
          "Minnesota",
          "Mississippi",
          "Missouri",
          "Montana",
          "Nebraska",
          "Nevada",
          "New Hampshire",
          "New Jersey"];

      var all_states_g5 = [
          "New Mexico",
          "New York",
          "North Carolina",
          "North Dakota",
          "Northern Mariana Islands",
          "Ohio",
          "Oklahoma",
          "Oregon"];

      var all_states_g6 = [
          "Pennsylvania",
          "Puerto Rico",
          "Rhode Island",
          "South Carolina",
          "South Dakota",
          "Tennessee",
          "Texas",
          "Utah"];

        var all_states_g7 = [// 6 * 8 = 48 + 7 = 55
          "Vermont",
          "Virgin Islands",
          "Virginia",
          "Washington",
          "West Virginia",
          "Wisconsin",
          "Wyoming"
          ];

      var state_groups = [all_states_g1, all_states_g2, all_states_g3, all_states_g4, all_states_g5, all_states_g6, all_states_g7];

      // private
      function get_d_val(isCases, d) {
        if(isCases)
        {
          return d.cases;
        }
        else
        {
          return d.deaths;
        }
      }

      // public
      function mul_lines_func (isCases) {

        // TODO, tooltip not work yet
        if (isCases) {
            pos_tooltip = "#tooltip_lines_left";
            div_pos = "#mul_line_left";
            char_title = "Chart-1: Trends in cases";
        } else {
            pos_tooltip = "#tooltip_lines_left";
            div_pos = "#mul_line_left"; /// We just append
            char_title = "Chart-2: Trends in deaths";
        }

        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 30, left: 60},
          width = 860 - margin.left - margin.right,
          height = 300 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select(div_pos)
          .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

        svg.append("text")
          .attr("class", "h2")
          .attr("x", width/2)
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .attr("y", 0 - (-20))
          .attr("text-anchor", "middle")
          .text(char_title);

        // Read the data
        d3.csv("data/us-states-trend.csv", function(data) {

          var parseTime = d3.timeParse("%Y/%m/%d");

          data.forEach(function(d) {
              d.date = parseTime(d.date);
            });

          // group the data: I want to draw one line per group
          var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
            .key(function(d) { return d.state;})
            .entries(data);

          // Add X axis --> it is a date format
          var x = d3.scaleLinear()
            .domain(d3.extent(data, function(d) { return d.date; }))
            .range([ 0, width ]);

          svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%Y-%m")))

          // Add Y axis
          var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) {return +get_d_val(isCases, d);})])
            .range([ height, 0 ]);

          svg.append("g")
            .call(d3.axisLeft(y));

          // color palette
          var res = sumstat.map(function(d){ return d.key }) // list of group names



          // Draw the line
          svg.selectAll(".line")
            .data(sumstat)
            .enter()
            .append("path")
            .attr("fill", "none")
            .attr("stroke", function(d){return all_colors_based_on_state[d.values[0].state] })
            .attr("stroke-width", 1.5)
            .attr("d", function(d){
              return d3.line()
                .x(function(d) { return x(d.date); })
                .y(function(d) {return y(+get_d_val(isCases, d));})
                (d.values)
            })
            .on("mouseover", function(d,i) { // TODO, tooltip not work yet

              tooltip.transition()
                  .duration(200)
                  .style("opacity", .9);
              d3.select(this).style('opacity', .5);

              selected_info = d.values[d.values.length - 1];

              tooltip.html("<h4>" + selected_info["state"] + "</h4><table>"
                  + "<tr><td>The latest cases<td>" + format_num(selected_info["cases"]) + "</tr></td>"
                  + "<tr><td>The latest deaths<td>" + format_num(selected_info["deaths"]) + "</tr></td>")
                  .style("left", (d3.event.pageX + 5) + "px")
                  .style("top", (d3.event.pageY - 28) + "px");

                d3.select(this).style('opacity', .5);
            })
            .on("mouseout", function() {
              tooltip.transition()
                  .duration(500)
                  .style("opacity", 0);
               d3.select(this).style('opacity', 1);
             })
          })

          // begin annotation
          // Features of the annotation
        const annotations = [
          {
            note: {
              label: "From 2020-01 to 2021-07.",
              title: "California",
              wrap: 0,  // try something smaller to see text split in several lines
              padding: 2   // More = text lower
            },
            x: 500,
            y: 100,
            dy: 0,
            dx: -200,
            color: ["red"],
          }
        ]

        // Add annotation to the chart
        const makeAnnotations = d3.annotation()
          .annotations(annotations)

          if (isCases) {
              svg.append("g")
                .call(makeAnnotations)
          }

          // end annotiation
      }
      mul_lines_func(true)
      mul_lines_func(false)

      </script>
      <!-- Create a div where the graph will take place -->

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script>
// select the svg area
var Svg = d3.select("#legend_mul_lines")

  // Add one dot in the legend for each name.
  i = 6;
  for (i = 0; i < 8; i++) {
  tmp_states = state_groups[i];
  var size = 20
  Svg.selectAll("mydots")
    .data(tmp_states)
    .enter()
    .append("circle")
    .attr("cx", 100 + i * 100)
    .attr("cy", function(d,i){ return 100 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
    .attr("r", 7)
    .style("fill", function(d){return all_colors_based_on_state[d]})


  // Add one dot in the legend for each name.
  Svg.selectAll("mylabels")
    .data(tmp_states)
    .enter()
    .append("text")
    .attr("x", 120 + i * 100)
    .attr("y", function(d,i){ return 100 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
    .style("fill", function(d){ return all_colors_based_on_state[d]})
    .text(function(d){ return d.substring(0, 7)})
    .attr("text-anchor", "left")
    .style("alignment-baseline", "middle")
  }
</script>


    </section>



    <!-- page 2: multiple bars -->
    <!-- ************************** -->
    <section class="" id="section_mul_bars">
      <button type="button" onclick="init_pages()">Home</button>
      <button type="button" onclick="update_mul_bars_pre()">Previous</button>
      <button type="button" onclick="update_mul_bars_next()">Next</button>

      <H1>Page-3: Cases Comparison Between States</H1>

      <div id="dataviz_builtWithD3"></div>

      <script>
      // To handle the sort option
      // ------------------------------------
      // Create data = list of groups
      var allGroup = ["Descending", "Ascending",  "Alphabetical"]
      // Initialize the button
      var dropdownButton = d3.select("#dataviz_builtWithD3")
        .append('select')

      // add the options to the button
      dropdownButton // Add a button
        .selectAll('myOptions') // Next 4 lines add 6 options = 6 colors
       	.data(allGroup)
        .enter()
      	.append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("value", function (d) { return d; }) // corresponding value returned by the button

      // Initialize a circle
      var bar_sort_option = "Descending";
      //var bar_sort_option = "Descending";
      //var bar_sort_option = "Alphabetical";
      // When the button is changed, run the updateChart function
      dropdownButton.on("change", function(d) {
          // recover the option that has been chosen
          bar_sort_option = d3.select(this).property("value");
          console.log("selectedOption has been updated to " + bar_sort_option);
          //d3.selectAll('#mul_bars_left').remove();
          //d3.select("#section_mul_bars").html("<h1> peter</h1>");
          bars_func(true);
          bars_func(false);
      })

      </script>
      <!-- Create a div where the graph will take place -->
      <div id="tooltip_bar_left"></div>
      <div id="mul_bars_left"></div>
      <div id="tooltip_bar_right"></div>
      <div id="mul_bars_right"></div>

      <script>

        function get_d_val(isCases, d) {
          if(isCases)
          {
            return d.cases;
            }
            else
            {
              return d.deaths;
            }
          }
        function bars_func (isCases) {
          //var pos = "";
          //var pos_tooltip = "";
          if(isCases)
          {
            pos_tooltip = "#tooltip_bar_left";
            pos = "#mul_bars_left";
            char_title = "Chart-1: Comparasion in cases";
          }
          else
          {
            pos_tooltip = "#tooltip_bar_right";
            pos = "#mul_bars_right";
            char_title = "Chart-2: Comparasion in deaths";
          }

          // Re-draw
          d3.select(pos).selectAll("svg").remove();

          // set the dimensions and margins of the graph
          var margin = {top: 30, right: 30, bottom: 70, left: 60},
              width = 1260 - margin.left - margin.right,
              height = 300 - margin.top - margin.bottom;

          // append the svg object to the body of the page
          var svg = d3.select(pos)
            .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

          svg.append("text")
            .attr("class", "h2")
            .attr("x", width/2)
            .style("font-size", "20px")
            .style("text-decoration", "underline")
            .attr("y", 0 - (-20))
            .attr("text-anchor", "middle")
            .text(char_title);

          // Parse the Data
          d3.csv("data/us-states-bar-map.csv", function(data) {
            // sort data
            data.sort(function(b, a) {
              if (bar_sort_option == "Ascending") {
                console.log("bar_sort_option is " + bar_sort_option);
                return get_d_val(isCases, b) - get_d_val(isCases, a);
              } else if (bar_sort_option == "Descending") {
                console.log("bar_sort_option is " + bar_sort_option);
                return get_d_val(isCases, a) - get_d_val(isCases, b);
              } else if (bar_sort_option == "Alphabetical") {
                console.log("bar_sort_option is " + bar_sort_option);
                return a.state > b.state;
              } else {
                console.log("A wrong option. It never happen:bar_sort_option = " + bar_sort_option);
              }
            });

          // color palette
          var res = data.map(function(d){ return d.state }) // list of group names

          // X axis
          var x = d3.scaleBand()
            .range([ 0, width ])
            .domain(data.map(function(d) { return d.state; }))
            .padding(0.2);
          svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
            .selectAll("text")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end");

          // Add Y axis
          var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) {return +get_d_val(isCases, d);})])
            .range([ height, 0]);
          svg.append("g")
            .call(d3.axisLeft(y));

          // Bars
          svg.selectAll("mybar")
            .data(data)
            .enter()
            .append("rect")
              .attr("x", d=> x(d.state))
              .attr("y", d=> y(get_d_val(isCases, d)))
              .attr("width", x.bandwidth())
              .attr("height", d=> height - y(get_d_val(isCases, d)))
              .attr("fill", function(d){return all_colors_based_on_idx[d.color]})
              .on("mouseover", function(d) {
                  tooltip.transition()
                      .duration(200)
                      .style("opacity", .9);
                  d3.select(this).style('opacity', .5);
                  if (isCases) {
                    tooltip.html("<h4>" + d.state + "</h4><table>"
                        + "<tr><td>cases<td>" + format_num(d.cases) + "</tr></td>"
                        + "<tr><td>cass_percent<td>" + d.cases_percent + "</tr></td>")
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                  }
                  else {
                    tooltip.html("<h4>" + d.state + "</h4><table>"
                        + "<tr><td>deaths<td>" + format_num(d.deaths) + "</tr></td>"
                        + "<tr><td>deaths_percent<td>" + d.deaths_percent + "</tr></td>")
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                  }
              })
              .on("mouseout", function(d) {
                  tooltip.transition()
                      .duration(500)
                      .style("opacity", 0);
                  d3.select(this).style('opacity', 1);
              });

          })
      }

      bars_func(true);
      bars_func(false);
      </script>
   </section>


   <!-- page 3: a map -->
   <!-- ************************** -->
   <section class="" id="section_mul_maps">
     <button type="button" onclick="init_pages()">Home</button>
     <button type="button" onclick="update_mul_map_pre()">Previous</button>
     <button type="button" onclick="update_mul_map_next()">Next</button>

      <H1>Page-4: Choropleth Map with Tooltips</H1>

      <!-- Create a div where the graph will take place -->
      <svg width="1200" height="500">
          <g id="legend_map_left" transform="translate(0, 0)">
          </g>
          <g id="mul_map_left" transform="translate(160, 30)">
          </g>
      </svg>
      <svg width="1200" height="500">
          <g id="legend_map_right" transform="translate(0, 0)">
          </g>
          <g id="mul_map_right" transform="translate(160, 30)">
          </g>
      </svg>
      <div id="tooltip_map_left"></div>

      <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

      <script>
      // +++++++++++++++++++legend of the map+++++++++++++++++++++++++++
      function split(left, right, parts) {
          var result = [],
              delta = (right - left) / (parts - 1);
          while (left < right) {
              result.push(left);
              left += delta;
          }
          result.push(right);
          return result;
      }

       function map_func (isCases) {
         if(isCases)
         {
           pos_tooltip = "#tooltip_map_left";
           pos = "#mul_map_left";
           legend_map = "#legend_map_left";
         }
         else
         {
           pos_tooltip = "#tooltip_map_left";
           pos = "#mul_map_right";
           legend_map = "#legend_map_right";
         }
           // https://bl.ocks.org/wboykinm/dbbe50d1023f90d4e241712395c27fb3
           var margin = {top: 40, right: 40, bottom: 40, left: 40},
               width = 850,// - margin.left - margin.right,
               height = 450;// - margin.top - margin.bottom;

               var lowColor = '#f9f9f9'
               var highColor = '#bc2a66'

               // D3 Projection
               var projection = d3.geoAlbersUsa()
                 .translate([width / 2, height / 2])  // translate to center of screen
                 .scale([1000]);                      // scale things down so see entire US

               // Define path generator
               var path = d3.geoPath()     // path generator that will convert GeoJSON to SVG paths
                 .projection(projection);    // tell path generator to use albersUsa projection

               // Create SVG element and append map to the SVG
               var g_map = d3.select(pos).append("g");
               var svg = g_map
                   .append("svg")
                   .attr("width", width + margin.left + margin.right)
                   .attr("height", height + margin.top + margin.bottom);

               // Load in my states data!
               d3.csv("data/us-states-bar-map.csv", function(data) {
                 var dataArray = [];
                    for (var i = 0; i < data.length; i++) {
                    if(isCases) {
                       data[i].value = data[i].cases;
                    } else {

                      data[i].value = data[i].deaths;
                    }
                    dataArray.push(parseFloat(data[i].value))
                    }
                    var minVal = d3.min(dataArray)
                    var maxVal = d3.max(dataArray)
                    var ramp = d3.scaleLinear().domain([minVal, maxVal]).range([lowColor, highColor])

                 // Load my data and merge with states data
                 d3.json("data/us-states.json", function(json) {

                 // Loop through each state data value in the .csv file
                 for (var i = 0; i < data.length; i++) {

                   // Find the corresponding state inside the GeoJSON
                   for (var j = 0; j < json.features.length; j++) {
                       var jsonState = json.features[j].properties.name;
                       var d = data[i]
                       if ( d.state == jsonState) {
                           // Copy the data value into the JSON
                           json.features[j].properties.value = d.value;

                           if (isCases) {
                             //json.features[j].properties.color = d.color;
                             json.features[j].properties.cases = d.cases;
                             json.features[j].properties.cases_percent = d.cases_percent;
                           }
                           else {
                             //json.features[j].properties.color = d.color;
                             json.features[j].properties.deaths = d.deaths;
                             json.features[j].properties.deaths_percent = d.deaths_percent;
                           }

                           // Stop looking through the JSON
                           break;
                       }
                   }
               }

               // Bind the data to the SVG and create one path per GeoJSON feature
               svg.selectAll("path")
                   .data(json.features)
                   .enter()
                   .append("path")
                   .attr("d", path)
                   .style("stroke", "#fff")
                   .style("stroke-width", "1")
                   .style("fill", function(d) {return ramp(d.properties.value)})
                   .on("mouseover", function(d) {
                       tooltip.transition()
                           .duration(200)
                           .style("opacity", .9);
                       d3.select(this).style('opacity', .5);
                       if (isCases) {
                         tooltip.html("<h4>" + d.properties.name + "</h4><table>"
                             + "<tr><td>cases<td>" + format_num(d.properties.cases) + "</tr></td>"
                             + "<tr><td>cass_percent<td>" + d.properties.cases_percent + "</tr></td>")
                             .style("left", (d3.event.pageX + 5) + "px")
                             .style("top", (d3.event.pageY - 28) + "px");

                       }
                       else {
                         tooltip.html("<h4>" + d.properties.name + "</h4><table>"
                             + "<tr><td>deaths<td>" + format_num(d.properties.deaths) + "</tr></td>"
                             + "<tr><td>deaths_percent<td>" + d.properties.deaths_percent + "</tr></td>")
                             .style("left", (d3.event.pageX + 5) + "px")
                             .style("top", (d3.event.pageY - 28) + "px");
                       }

                   })
                   .on("mouseout", function(d) {
                       tooltip.transition()
                           .duration(500)
                           .style("opacity", 0);
                       d3.select(this).style('opacity', 1);
                   });
                   if(isCases)
                   {
                     char_title = "Chart-1: Compare based on cases";
                   }
                   else
                   {
                     char_title = "Chart-2: Compare based on deaths";
                   }
                   svg.append("text")
                     .attr("class", "h2")
                     .attr("x", width/2)
                     .style("font-size", "20px")
                     .style("text-decoration", "underline")
                     .attr("y", 0 - (-20))
                     .attr("text-anchor", "middle")
                     .text(char_title);
                  console.log(char_title)
               });

               // select the svg area
               if(isCases)
               {
                 legend_map = "#legend_map_left";
               }
               else
               {
                 legend_map = "#legend_map_right";
               }
               var Svg = d3.select(legend_map);
               console.log("legend_map = " + legend_map);
               map_legent_values = split(minVal, maxVal, 9);

                 // Add one dot in the legend for each name.
                 i = 6;
                 for (i = 0; i < 1; i++) {
                 tmp_states = state_groups[i];
                 var size = 20
                 Svg.selectAll("mydots")
                   .data(tmp_states)
                   .enter()
                   .append("circle")
                   .attr("cx", 100 + i * 100)
                   .attr("cy", function(d,i){ return 100 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
                   .attr("r", 7)
                   .style("fill", function(d, i){return ramp(map_legent_values[8 - i])})

                 // http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e
                 format_s = d3.format("0.3s")

                 // Add one dot in the legend for each name.
                 Svg.selectAll("mylabels")
                   .data(tmp_states)
                   .enter()
                   .append("text")
                   .attr("x", 120 + i * 100)
                   .attr("y", function(d,i){ return 100 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
                   .style("fill", function(d, i){ return ramp(map_legent_values[8 - i])})
                   .text(function(d, i){ return format_s(Math.trunc(map_legent_values[8 - i]))})
                   .attr("text-anchor", "left")
                   .style("alignment-baseline", "middle")
                 }

           }

         );



       }

       map_func (true);
       map_func (false);
       </script>
    </section>


    <!-- page 4: the last page -->
    <!-- ************************** -->
    <section class="" id="section_last_page">
      <button type="button" onclick="init_pages()">Home</button>
      <button type="button" onclick="update_last_page_pre()">Previous</button>
      <button type="button", id="last_next_button">Next</button>
      <H1>Page-5: Thank You</H1>

      <h2><br/>Contact</h2>

      <ul>
          <li>Peter Zhang</li>
          <li>aijun2@illinois.edu</li>
          <li>peterzhangon@gmail.com</li>
      </ul>

      <h2><br/>Related Resources</h2>
      <ul>
          <li><a href='https://cs.illinois.edu/academics/graduate/professional-mcs/online-master-computer-science' target='_blank'>MCS program at UIUC</a></li>
          <li><a href='https://github.com/nytimes/covid-19-data/blob/master/us-states.csv' target='_blank'>CS 498 Data Visualization</a></li>
      </ul>

    </section>

    <script>
      function init_pages() {
        console.log("init pages.");
        document.getElementById("section_home_page").style.display = 'block'; // current
        document.getElementById("section_mul_lines").style.display = 'none';
        document.getElementById("section_mul_bars").style.display = 'none';
        document.getElementById("section_mul_maps").style.display = 'none';
        document.getElementById("section_last_page").style.display = 'none';
        // Disable buttons
        document.getElementById("home_home_button").disabled = true;
        document.getElementById("home_pre_button").disabled = true;
        document.getElementById("last_next_button").disabled = true;
      }
      init_pages();

      // Home page
      function update_home_next() {
        console.log("page: Home - > line.");
        document.getElementById("section_home_page").style.display = 'none'; // current
        document.getElementById("section_mul_lines").style.display = 'block';
        document.getElementById("section_mul_bars").style.display = 'none';
        document.getElementById("section_mul_maps").style.display = 'none';
        document.getElementById("section_last_page").style.display = 'none';
      }

      // Page 1: multiple lines
      function update_mul_lines_pre() {
        console.log("page: Line - > Home.");
        document.getElementById("section_home_page").style.display = 'block';
        document.getElementById("section_mul_lines").style.display = 'none';// current
        document.getElementById("section_mul_bars").style.display = 'none';
        document.getElementById("section_mul_maps").style.display = 'none';
        document.getElementById("section_last_page").style.display = 'none';
      }
      function update_mul_lines_next() {
        console.log("page: Line - > bar.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'none';// current
        document.getElementById("section_mul_bars").style.display = 'block';
        document.getElementById("section_mul_maps").style.display = 'none';
        document.getElementById("section_last_page").style.display = 'none';
      }

      // Page 2 : multiple bars
      function update_mul_bars_pre() {
        console.log("page: bar - > line.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'block';
        document.getElementById("section_mul_bars").style.display = 'none';// current
        document.getElementById("section_mul_maps").style.display = 'none';
        document.getElementById("section_last_page").style.display = 'none';
      }
      function update_mul_bars_next() {
        console.log("page: bar - > map.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'none';
        document.getElementById("section_mul_bars").style.display = 'none';// current
        document.getElementById("section_mul_maps").style.display = 'block';
        document.getElementById("section_last_page").style.display = 'none';
      }

      // Page 3 : map
      function update_mul_map_pre() {
        console.log("page: map - > bar.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'none';
        document.getElementById("section_mul_bars").style.display = 'block';
        document.getElementById("section_mul_maps").style.display = 'none';// current
        document.getElementById("section_last_page").style.display = 'none';
      }
      function update_mul_map_next() {
        console.log("page: map - > end.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'none';
        document.getElementById("section_mul_bars").style.display = 'none';
        document.getElementById("section_mul_maps").style.display = 'none'; // current
        document.getElementById("section_last_page").style.display = 'block';
      }

      // Page 4 : last page
      function update_last_page_pre() {
        console.log("page: map - > last page.");
        document.getElementById("section_home_page").style.display = 'none';
        document.getElementById("section_mul_lines").style.display = 'none';
        document.getElementById("section_mul_bars").style.display = 'none';
        document.getElementById("section_mul_maps").style.display = 'block';
        document.getElementById("section_last_page").style.display = 'none';// current
      }
    </script>
  </body>
</html>
